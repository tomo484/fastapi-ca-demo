(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7849:function(e,s,t){Promise.resolve().then(t.bind(t,643))},643:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return S}});var r=t(481),a=t(110);function n(e){let{title:s}=e;return(0,r.jsx)("header",{className:"border-b border-border bg-card",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,r.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:s})})})}var i=t(2856),l=t(3280);function o(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,l.m6)((0,i.W)(s))}let c=(0,a.forwardRef)((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:o("container mx-auto px-4",t),...a})});c.displayName="Container";let d=(0,a.forwardRef)((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:o("rounded-lg border border-border bg-card text-card-foreground shadow-sm",t),...a})}),u=(0,a.forwardRef)((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:o("flex flex-col space-y-1.5 p-6",t),...a})}),m=(0,a.forwardRef)((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:o("p-6 pt-0",t),...a})});d.displayName="Card",u.displayName="CardHeader",m.displayName="CardContent";let x=(0,a.forwardRef)((e,s)=>{let{className:t,variant:a="default",size:n="default",isLoading:i,children:l,disabled:c,...d}=e;return(0,r.jsxs)("button",{className:o("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring","disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-primary-foreground hover:bg-primary/90":"default"===a,"bg-destructive text-destructive-foreground hover:bg-destructive/90":"destructive"===a,"border border-input bg-background hover:bg-accent hover:text-accent-foreground":"outline"===a,"bg-secondary text-secondary-foreground hover:bg-secondary/80":"secondary"===a,"hover:bg-accent hover:text-accent-foreground":"ghost"===a},{"h-10 px-4 py-2":"default"===n,"h-9 rounded-md px-3":"sm"===n,"h-11 rounded-md px-8":"lg"===n},t),ref:s,disabled:c||i,...d,children:[i&&(0,r.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",className:"opacity-25"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),l]})});x.displayName="Button";let h=(0,a.forwardRef)((e,s)=>{let{className:t,type:a,error:n,...i}=e;return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("input",{type:a,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm","ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2","focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n&&"border-destructive focus-visible:ring-destructive",t),ref:s,...i}),n&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:n})]})});function f(e){let{task:s,onSubmit:t,onCancel:n,isLoading:i}=e,[l,o]=(0,a.useState)((null==s?void 0:s.title)||""),[c,d]=(0,a.useState)("");return(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!l.trim()){d("タスクタイトルは必須です");return}d(""),t({title:l.trim()}),s||o("")},className:"space-y-4",children:[(0,r.jsx)(h,{value:l,onChange:e=>o(e.target.value),placeholder:"タスクのタイトルを入力してください",error:c}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(x,{type:"submit",isLoading:i,className:"flex-1",children:s?"更新":"追加"}),n&&(0,r.jsx)(x,{type:"button",variant:"outline",onClick:n,children:"キャンセル"})]})]})}function v(e){let{onFilterChange:s}=e,[t,n]=(0,a.useState)("all"),[i,l]=(0,a.useState)(""),o=e=>{n(e),s({status:e,search:i})},c=e=>{l(e),s({status:t,search:e})};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(x,{variant:"all"===t?"default":"outline",size:"sm",onClick:()=>o("all"),children:"全て"}),(0,r.jsx)(x,{variant:"pending"===t?"default":"outline",size:"sm",onClick:()=>o("pending"),children:"未完了"}),(0,r.jsx)(x,{variant:"done"===t?"default":"outline",size:"sm",onClick:()=>o("done"),children:"完了"})]}),(0,r.jsx)(h,{value:i,onChange:e=>c(e.target.value),placeholder:"タスクを検索..."})]})}function y(e){let{task:s,onToggleDone:t,onEdit:a,onDelete:n}=e;return(0,r.jsx)(d,{className:s.done?"opacity-75":"",children:(0,r.jsx)(m,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("button",{onClick:()=>t(s.id),className:"w-5 h-5 rounded border-2 flex items-center justify-center ".concat(s.done?"bg-primary border-primary text-primary-foreground":"border-input hover:border-primary"),children:s.done&&(0,r.jsx)("span",{className:"text-xs",children:"✓"})}),(0,r.jsx)("span",{className:"text-sm ".concat(s.done?"line-through text-muted-foreground":"text-foreground"),children:s.title||"無題のタスク"})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(x,{variant:"ghost",size:"sm",onClick:()=>a(s),className:"text-muted-foreground hover:text-foreground",children:"編集"}),(0,r.jsx)(x,{variant:"ghost",size:"sm",onClick:()=>n(s.id),className:"text-muted-foreground hover:text-destructive",children:"削除"})]})]})})})}function g(e){let{tasks:s,isLoading:t,onToggleDone:a,onEdit:n,onDelete:i}=e;return t?(0,r.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0].map((e,s)=>(0,r.jsx)("div",{className:"animate-pulse",children:(0,r.jsx)("div",{className:"h-16 bg-muted rounded-lg"})},s))}):0===s.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"text-muted-foreground text-lg mb-2",children:"タスクがありません"}),(0,r.jsx)("div",{className:"text-muted-foreground text-sm",children:"新しいタスクを追加してみましょう"})]}):(0,r.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,r.jsx)(y,{task:e,onToggleDone:a,onEdit:n,onDelete:i},e.id))})}h.displayName="Input";var p=t(7188),j=t(2886);let b=j.Z.create({baseURL:"http://localhost:8000",timeout:1e3,headers:{"Content-Type":"application/json"}});b.interceptors.request.use(e=>e,e=>{var s;return console.error("API Error:",(null===(s=e.response)||void 0===s?void 0:s.data)||e.message),Promise.reject(e)});let N=()=>(0,p.a)({queryKey:["tasks"],queryFn:async()=>{let e=await b.get("/tasks");return e.data},staleTime:3e5,refetchOnWindowFocus:!1});var k=t(2449),w=t(7058);let C=()=>{let e=(0,k.NL)(),s=(0,w.D)({mutationFn:async e=>{let s=await b.post("/tasks",e);return s.data},onSuccess:()=>{e.invalidateQueries({queryKey:["tasks"]})},onError:e=>{console.error("タスク作成エラー:",e)}}),t=(0,w.D)({mutationFn:e=>{let{id:s,data:t}=e;return(async(e,s)=>{let t=await b.put("/tasks/".concat(e),s);return t.data})(s,t)},onSuccess:()=>{e.invalidateQueries({queryKey:["tasks"]})},onMutate:async s=>{let{id:t,data:r}=s;await e.cancelQueries({queryKey:["tasks"]});let a=e.getQueryData(["tasks"]);return e.setQueryData(["tasks"],e=>null==e?void 0:e.map(e=>e.id===t?{...e,...r}:e)),{previousTasks:a}},onError:(s,t,r)=>{e.setQueryData(["tasks"],null==r?void 0:r.previousTasks)}}),r=(0,w.D)({mutationFn:async e=>{await b.delete("/tasks/".concat(e))},onSuccess:()=>{e.invalidateQueries({queryKey:["tasks"]})}}),a=(0,w.D)({mutationFn:async e=>{let s=await b.post("/tasks/".concat(e,"/done"));return s.data},onSuccess:()=>{e.invalidateQueries({queryKey:["tasks"]})},onMutate:async s=>{await e.cancelQueries({queryKey:["tasks"]});let t=e.getQueryData(["tasks"]);return e.setQueryData(["tasks"],e=>null==e?void 0:e.map(e=>e.id===s?{...e,done:!0}:e)),{previousTasks:t}},onError:(s,t,r)=>{e.setQueryData(["tasks"],null==r?void 0:r.previousTasks)}}),n=(0,w.D)({mutationFn:async e=>{let s=await b.delete("/tasks/".concat(e,"/done"));return s.data},onSuccess:()=>{e.invalidateQueries({queryKey:["tasks"]})},onMutate:async s=>{await e.cancelQueries({queryKey:["tasks"]});let t=e.getQueryData(["tasks"]);return e.setQueryData(["tasks"],e=>null==e?void 0:e.map(e=>e.id===s?{...e,done:!1}:e)),{previousTasks:t}},onError:(s,t,r)=>{e.setQueryData(["tasks"],null==r?void 0:r.previousTasks)}});return{createTask:s,updateTask:t,deleteTask:r,markDone:a,markPending:n}};var D=t(6162);let Q=()=>{let e=(0,D.useRouter)(),s=(0,D.useSearchParams)(),t={done:"true"===s.get("done")||"false"!==s.get("done")&&void 0,search:s.get("search")||""},r=(0,a.useCallback)(s=>{let t=new URLSearchParams;void 0!==s.done&&t.set("done",String(s.done)),s.search&&t.set("search",s.search),e.push("?".concat(t.toString()))},[e]);return{filters:t,updateFilters:r}};function S(){let{data:e,isLoading:s,error:t}=N(),{createTask:i,updateTask:l,deleteTask:o,markDone:x,markPending:h}=C(),{filters:y,updateFilters:p}=Q(),[j,b]=(0,a.useState)(null),k=(null==e?void 0:e.filter(e=>{var s;return!!((void 0===y.done||e.done===y.done)&&(!y.search||(null===(s=e.title)||void 0===s?void 0:s.toLowerCase().includes(y.search.toLowerCase()))))}))||[],w=async e=>{try{await i.mutateAsync(e)}catch(e){console.error("タスク作成に失敗しました:",e)}},D=async e=>{if(j)try{await l.mutateAsync({id:j.id,data:e}),b(null)}catch(e){console.error("タスク更新に失敗しました:",e)}},S=async s=>{let t=null==e?void 0:e.find(e=>e.id===s);if(t)try{t.done?await h.mutateAsync(s):await x.mutateAsync(s)}catch(e){console.error("完了状態の切り替えに失敗しました:",e)}},q=async e=>{try{await o.mutateAsync(e)}catch(e){console.error("タスク削除に失敗しました:",e)}};return s?(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)(n,{title:"タスク管理アプリ"}),(0,r.jsx)("main",{children:(0,r.jsx)(c,{className:"py-8",children:(0,r.jsx)("div",{className:"flex justify-center items-center min-h-64",children:(0,r.jsx)("div",{className:"text-lg text-gray-600",children:"読み込み中..."})})})})]}):t?(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)(n,{title:"タスク管理アプリ"}),(0,r.jsx)("main",{children:(0,r.jsx)(c,{className:"py-8",children:(0,r.jsx)(d,{children:(0,r.jsx)(m,{className:"p-6",children:(0,r.jsxs)("div",{className:"text-center text-red-600",children:[(0,r.jsx)("p",{className:"text-lg font-semibold mb-2",children:"エラーが発生しました"}),(0,r.jsx)("p",{className:"text-sm",children:"データの読み込みに失敗しました。しばらく時間をおいて再度お試しください。"})]})})})})})]}):(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)(n,{title:"タスク管理アプリ"}),(0,r.jsx)("main",{children:(0,r.jsxs)(c,{className:"py-8",children:[(0,r.jsx)("section",{className:"mb-8",children:(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{children:(0,r.jsx)("h2",{className:"text-lg font-semibold",children:j?"タスクを編集":"新しいタスクを追加"})}),(0,r.jsx)(m,{children:(0,r.jsx)(f,{task:j||void 0,onSubmit:j?D:w,onCancel:j?()=>{b(null)}:void 0,isLoading:i.isPending||l.isPending})})]})}),(0,r.jsx)("section",{className:"mb-6",children:(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{className:"pb-3",children:(0,r.jsx)("h3",{className:"text-md font-medium",children:"フィルター・検索"})}),(0,r.jsx)(m,{children:(0,r.jsx)(v,{onFilterChange:e=>{p({done:"all"===e.status?void 0:"done"===e.status,search:e.search})}})})]})}),(0,r.jsx)("section",{children:(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{children:(0,r.jsxs)("h2",{className:"text-lg font-semibold",children:["タスク一覧 (",k.length,"件)"]})}),(0,r.jsx)(m,{children:(0,r.jsx)(g,{tasks:k,isLoading:!1,onToggleDone:S,onEdit:e=>{b(e)},onDelete:q})})]})})]})})]})}}},function(e){e.O(0,[809,363,153,807,744],function(){return e(e.s=7849)}),_N_E=e.O()}]);